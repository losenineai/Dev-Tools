<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
</head>
<body>
<div style="margin-top: 20px">
<!--<h2>GetDXRiskToken</h2>-->
<input type="button" value="GetDXRiskToken" onclick="call()">
<input type="button" value="GetDXRiskToken_test" onclick="call2()">
    <h3>GetDXRiskToken</h3>
    <label id="token">token</label>
    <br/>
     <label id="token2">token</label>
     <br/>
      <label id="token3">token</label>
<script>
    
    
    
var call = function()
{
<!--    DXRiskManager.setup-->
    var isSuccess = DXRiskManager.setup();
    var token = DXRiskManager.getToken('de88505f968de9730ee99fe84b8a2552' , {[DXRiskManagerKeyUserId]: '123456'});
    var label=document.getElementById("token");
    label.innerHTML=token;
}

var call2 = function()
{
    <!--    DXRiskManager.setup-->
   
    var label=document.getElementById("token2");
    label.innerHTML=s();
    
    label=document.getElementById("token3");
    label.innerHTML=s2();
    
    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.hasOwnProperty("Token_1")) {
        window.webkit.messageHandlers["Token_1"].postMessage(s());
    }
    
    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.hasOwnProperty("Token_2")) {
        window.webkit.messageHandlers["Token_2"].postMessage(s2());
    }
    
    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.hasOwnProperty("Token_3")) {
        window.webkit.messageHandlers["Token_3"].postMessage(s3());
    }
    
<!--    window.webkit.messageHandlers.jsCallOC.postMessage(document.getElementById("token2").innerHTML);-->
}


call2();

function s(){
    // Very simple now, need to make it more complex (geo shapes etc)
    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');
    var txt = "http://m.vip.com/";
    ctx.textBaseline = top;
    ctx.font = "14px 'Arial'";
    ctx.textBaseline = 'tencent';
    ctx.fillStyle = '#f60';
    ctx.fillRect(125,1,62,20);
    ctx.fillStyle = '#069';
    ctx.fillText(txt, 2, 15);
    ctx.fillStyle = 'rgb(102, 204, 0, 0.7)';
    ctx.fillText(txt, 4, 17);
    
    var b64 = canvas.toDataURL().replace("data:image/png;base64,","");
    var bin = atob(b64);
    var crc = bin2hex(bin.slice(-16,-12));
    console.log(crc);
    // document.querySelector("#fp1").textContent = crc
    return crc;
}

function s2(){
    // Very simple now, need to make it more complex (geo shapes etc)
    var canvas = document.createElement('canvas')
    canvas.width = 2000
    canvas.height = 200
    canvas.style.display = 'inline'
    var ctx = canvas.getContext('2d')
    // detect browser support of canvas winding
    // http://blogs.adobe.com/webplatform/2013/01/30/winding-rules-in-canvas/
    // https://github.com/Modernizr/Modernizr/blob/master/feature-detects/canvas/winding.js
    ctx.rect(0, 0, 10, 10)
    ctx.rect(2, 2, 6, 6)
    
    
    ctx.textBaseline = 'alphabetic'
    ctx.fillStyle = '#f60'
    ctx.fillRect(125, 1, 62, 20)
    ctx.fillStyle = '#069'
    // https://github.com/Valve/fingerprintjs2/issues/66
    
    ctx.font = '11pt no-real-font-123'
    
    ctx.fillText('Cwm fjordbank glyphs vext quiz, \ud83d\ude03', 2, 15)
    ctx.fillStyle = 'rgba(102, 204, 0, 0.2)'
    ctx.font = '18pt Arial'
    ctx.fillText('Cwm fjordbank glyphs vext quiz, \ud83d\ude03', 4, 45)
    
    // canvas blending
    // http://blogs.adobe.com/webplatform/2013/01/28/blending-features-in-canvas/
    // http://jsfiddle.net/NDYV8/16/
    ctx.globalCompositeOperation = 'multiply'
    ctx.fillStyle = 'rgb(255,0,255)'
    ctx.beginPath()
    ctx.arc(50, 50, 50, 0, Math.PI * 2, true)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = 'rgb(0,255,255)'
    ctx.beginPath()
    ctx.arc(100, 50, 50, 0, Math.PI * 2, true)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = 'rgb(255,255,0)'
    ctx.beginPath()
    ctx.arc(75, 100, 50, 0, Math.PI * 2, true)
    ctx.closePath()
    ctx.fill()
    ctx.fillStyle = 'rgb(255,0,255)'
    // canvas winding
    // http://blogs.adobe.com/webplatform/2013/01/30/winding-rules-in-canvas/
    // http://jsfiddle.net/NDYV8/19/
    ctx.arc(75, 75, 75, 0, Math.PI * 2, true)
    ctx.arc(75, 75, 25, 0, Math.PI * 2, true)
    ctx.fill('evenodd')
    
    var b64 = canvas.toDataURL().replace("data:image/png;base64,","");
    var bin = atob(b64);
    var crc = bin2hex(bin.slice(-16,-12));
    return crc;
    // console.log(crc);
    //  document.querySelector("#fp1").textContent = crc
}

function s3(){
    // Very simple now, need to make it more complex (geo shapes etc)
    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');
    
    var userAgentIndex = navigator.userAgent.indexOf('(KHTML, like Gecko)' , 0);
    
    var txt = navigator.userAgent.substring(0,userAgentIndex);
    
    var val = (screen.availHeight > screen.availWidth)
    ? [screen.availHeight, screen.availWidth]
    : [screen.availWidth, screen.availHeight];
    txt = txt + val.join("x");
    
    // console.log("navigator.txt= %o", txt);
    //Mozilla/5.0 (iPhone; CPU iPhone OS 12_1_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Mobile/15E148 Safari/604.1
    // 需要 第二个)之前数据
    
    ctx.textBaseline = top;
    ctx.font = "14px 'Arial'";
    ctx.textBaseline = 'ideographic';
    ctx.fillStyle = '#f60';
    ctx.fillRect(125,1,62,20);
    ctx.fillStyle = '#069';
    ctx.fillText(txt, 2, 15);
    ctx.fillStyle = 'rgb(102, 204, 0, 0.7)';
    ctx.fillText(txt, 4, 17);
    
    var b64 = canvas.toDataURL().replace("data:image/png;base64,","");
    var bin = atob(b64);
    var crc = bin2hex(bin.slice(-16,-12));
    // console.log(crc);
    // document.querySelector("#fp1").textContent = crc
    return crc;
}



function test(){
    return 1+2;
}


function bin2hex(str) {
    var result = "";
    for (i = 0; i < str.length; i++ ) {
        var c = str.charCodeAt(i);
        result += byte2Hex(c>>8 & 0xff); // 高字节
        result += byte2Hex(c & 0xff); // 低字节
    }
    return result;
}
function byte2Hex(s) {
    var i, l, o = '', n;
    
    s += '';
    
    for (i = 0, l = s.length; i < l; i++) {
        n = s.charCodeAt(i)
        .toString(16);
        o += n.length < 2 ? '0' + n : n;
    }
    
    return o;
}




</script>

<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/jquery.easing.min.js"></script>
<script src="js/math.min.js"></script>
<script src="js/gyronorm.complete.min.js"></script>
<script type="text/javascript" src="https://wurfl.io/wurfl.js"></script>
<script src="js/matrix.js"></script>
<script src="js/numeric-1.2.6.min.js"></script>
<script src="js/gyro.js"></script>


</body>
</html>
